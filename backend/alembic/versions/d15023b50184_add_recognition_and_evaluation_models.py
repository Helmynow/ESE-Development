"""Add recognition and evaluation models

Revision ID: d15023b50184
Revises: 202502180001
Create Date: 2025-10-06 20:49:42.985998

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa

from backend.app.models.types import GUID


# revision identifiers, used by Alembic.
revision: str = 'd15023b50184'
down_revision: Union[str, Sequence[str], None] = '202502180001'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('eligibility_tracking',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('employee_id', GUID(), nullable=False),
    sa.Column('employee_name', sa.String(length=256), nullable=False),
    sa.Column('last_award_date', sa.DateTime(timezone=True), nullable=True),
    sa.Column('last_award_type', sa.Enum('EMPLOYEE_OF_MONTH', 'EMPLOYEE_OF_YEAR', 'SPECIAL_RECOGNITION', name='awardtype'), nullable=True),
    sa.Column('rotation_lock_until', sa.DateTime(timezone=True), nullable=True),
    sa.Column('ineligible', sa.Integer(), nullable=False),
    sa.Column('ineligibility_reason', sa.Text(), nullable=True),
    sa.Column('total_eom_wins', sa.Integer(), nullable=False),
    sa.Column('total_eoy_wins', sa.Integer(), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_eligibility_tracking_employee_id'), 'eligibility_tracking', ['employee_id'], unique=False)
    op.create_table('eoy_candidate',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('year', sa.Integer(), nullable=False),
    sa.Column('employee_id', GUID(), nullable=False),
    sa.Column('employee_name', sa.String(length=256), nullable=False),
    sa.Column('department', sa.String(length=128), nullable=False),
    sa.Column('eom_wins_count', sa.Integer(), nullable=False),
    sa.Column('avg_mre_score', sa.Float(), nullable=False),
    sa.Column('attendance_rate', sa.Float(), nullable=False),
    sa.Column('tenure_months', sa.Integer(), nullable=False),
    sa.Column('has_disciplinary_actions', sa.Integer(), nullable=False),
    sa.Column('meets_minimum_criteria', sa.Integer(), nullable=False),
    sa.Column('ceo_vote_score', sa.Float(), nullable=True),
    sa.Column('pc_head_vote_score', sa.Float(), nullable=True),
    sa.Column('eoy_score', sa.Float(), nullable=True),
    sa.Column('rank', sa.Integer(), nullable=True),
    sa.Column('is_winner', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_eoy_candidate_employee_id'), 'eoy_candidate', ['employee_id'], unique=False)
    op.create_index(op.f('ix_eoy_candidate_year'), 'eoy_candidate', ['year'], unique=False)
    op.create_table('evaluation_cycle',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('cycle_name', sa.String(length=128), nullable=False),
    sa.Column('cycle_period', sa.String(length=7), nullable=False),
    sa.Column('start_date', sa.DateTime(timezone=True), nullable=False),
    sa.Column('end_date', sa.DateTime(timezone=True), nullable=False),
    sa.Column('status', sa.Enum('DRAFT', 'ACTIVE', 'CLOSED', 'ARCHIVED', name='evaluationcyclestatus'), nullable=False),
    sa.Column('created_by', GUID(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('activated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('closed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('total_evaluations', sa.Integer(), nullable=False),
    sa.Column('completed_evaluations', sa.Integer(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_evaluation_cycle_cycle_period'), 'evaluation_cycle', ['cycle_period'], unique=False)
    op.create_table('fairness_metric',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('metric_type', sa.String(length=64), nullable=False),
    sa.Column('period', sa.String(length=7), nullable=False),
    sa.Column('metric_data', sa.JSON(), nullable=False),
    sa.Column('alert_level', sa.String(length=32), nullable=True),
    sa.Column('alert_message', sa.Text(), nullable=True),
    sa.Column('resolved', sa.Integer(), nullable=False),
    sa.Column('resolved_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('resolved_by', GUID(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('nomination',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('nominee_id', GUID(), nullable=False),
    sa.Column('nominee_name', sa.String(length=256), nullable=False),
    sa.Column('nominee_department', sa.String(length=128), nullable=False),
    sa.Column('category', sa.Enum('TEACHING_EXCELLENCE', 'INNOVATION', 'TEAMWORK', 'LEADERSHIP', 'SERVICE_EXCELLENCE', 'STUDENT_ADVOCACY', name='nominationcategory'), nullable=False),
    sa.Column('nominator_id', GUID(), nullable=False),
    sa.Column('nominator_name', sa.String(length=256), nullable=False),
    sa.Column('description', sa.Text(), nullable=False),
    sa.Column('submitted_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('status', sa.Enum('PENDING', 'VOTING', 'SELECTED', 'REJECTED', name='nominationstatus'), nullable=False),
    sa.Column('nomination_period', sa.String(length=7), nullable=False),
    sa.Column('votes_count', sa.Integer(), nullable=False),
    sa.Column('total_eligible_voters', sa.Integer(), nullable=True),
    sa.Column('ai_analysis', sa.JSON(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_nomination_nominee_id'), 'nomination', ['nominee_id'], unique=False)
    op.create_table('award',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('recipient_id', GUID(), nullable=False),
    sa.Column('recipient_name', sa.String(length=256), nullable=False),
    sa.Column('department', sa.String(length=128), nullable=False),
    sa.Column('award_type', sa.Enum('EMPLOYEE_OF_MONTH', 'EMPLOYEE_OF_YEAR', 'SPECIAL_RECOGNITION', name='awardtype'), nullable=False),
    sa.Column('category', sa.Enum('TEACHING_EXCELLENCE', 'INNOVATION', 'TEAMWORK', 'LEADERSHIP', 'SERVICE_EXCELLENCE', 'STUDENT_ADVOCACY', name='nominationcategory'), nullable=True),
    sa.Column('award_period', sa.String(length=7), nullable=False),
    sa.Column('description', sa.Text(), nullable=False),
    sa.Column('granted_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('nomination_id', GUID(), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['nomination_id'], ['nomination.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_award_recipient_id'), 'award', ['recipient_id'], unique=False)
    op.create_table('evaluation',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('cycle_id', GUID(), nullable=False),
    sa.Column('evaluee_id', GUID(), nullable=False),
    sa.Column('evaluee_name', sa.String(length=256), nullable=False),
    sa.Column('evaluee_department', sa.String(length=128), nullable=False),
    sa.Column('evaluee_staff_type', sa.Enum('ACADEMIC', 'ADMINISTRATIVE', name='stafftype'), nullable=False),
    sa.Column('evaluator_id', GUID(), nullable=False),
    sa.Column('evaluator_name', sa.String(length=256), nullable=False),
    sa.Column('evaluator_role', sa.Enum('SELF', 'PEER', 'SUPERVISOR', 'CEO', 'PC_HEAD', name='evaluatorrole'), nullable=False),
    sa.Column('weight', sa.Float(), nullable=False),
    sa.Column('status', sa.Enum('NOT_STARTED', 'IN_PROGRESS', 'SUBMITTED', 'LATE', name='evaluationstatus'), nullable=False),
    sa.Column('assigned_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('submitted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('due_date', sa.DateTime(timezone=True), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['cycle_id'], ['evaluation_cycle.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_evaluation_cycle_id'), 'evaluation', ['cycle_id'], unique=False)
    op.create_index(op.f('ix_evaluation_evaluator_id'), 'evaluation', ['evaluator_id'], unique=False)
    op.create_index(op.f('ix_evaluation_evaluee_id'), 'evaluation', ['evaluee_id'], unique=False)
    op.create_table('evaluation_result',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('cycle_id', GUID(), nullable=False),
    sa.Column('evaluee_id', GUID(), nullable=False),
    sa.Column('evaluee_name', sa.String(length=256), nullable=False),
    sa.Column('evaluee_department', sa.String(length=128), nullable=False),
    sa.Column('evaluee_staff_type', sa.Enum('ACADEMIC', 'ADMINISTRATIVE', name='stafftype'), nullable=False),
    sa.Column('self_score', sa.Float(), nullable=True),
    sa.Column('peer_scores_avg', sa.Float(), nullable=True),
    sa.Column('supervisor_score', sa.Float(), nullable=True),
    sa.Column('ceo_score', sa.Float(), nullable=True),
    sa.Column('pc_head_score', sa.Float(), nullable=True),
    sa.Column('final_score', sa.Float(), nullable=False),
    sa.Column('total_expected_ratings', sa.Integer(), nullable=False),
    sa.Column('received_ratings', sa.Integer(), nullable=False),
    sa.Column('completion_percentage', sa.Float(), nullable=False),
    sa.Column('score_variance', sa.Float(), nullable=True),
    sa.Column('has_high_variance', sa.Integer(), nullable=False),
    sa.Column('ai_insights', sa.JSON(), nullable=True),
    sa.Column('aggregated_strengths', sa.Text(), nullable=True),
    sa.Column('aggregated_improvements', sa.Text(), nullable=True),
    sa.Column('calculated_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('released_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['cycle_id'], ['evaluation_cycle.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_evaluation_result_cycle_id'), 'evaluation_result', ['cycle_id'], unique=False)
    op.create_index(op.f('ix_evaluation_result_evaluee_id'), 'evaluation_result', ['evaluee_id'], unique=False)
    op.create_table('vote',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('nomination_id', GUID(), nullable=False),
    sa.Column('voter_id', GUID(), nullable=False),
    sa.Column('voter_role', sa.String(length=64), nullable=False),
    sa.Column('category', sa.Enum('TEACHING_EXCELLENCE', 'INNOVATION', 'TEAMWORK', 'LEADERSHIP', 'SERVICE_EXCELLENCE', 'STUDENT_ADVOCACY', name='nominationcategory'), nullable=False),
    sa.Column('nomination_period', sa.String(length=7), nullable=False),
    sa.Column('voted_at', sa.DateTime(timezone=True), nullable=False),
    sa.ForeignKeyConstraint(['nomination_id'], ['nomination.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_vote_nomination_id'), 'vote', ['nomination_id'], unique=False)
    op.create_index(op.f('ix_vote_voter_id'), 'vote', ['voter_id'], unique=False)
    op.create_table('evaluation_rating',
    sa.Column('id', GUID(), nullable=False),
    sa.Column('evaluation_id', GUID(), nullable=False),
    sa.Column('cycle_id', GUID(), nullable=False),
    sa.Column('evaluator_id', GUID(), nullable=False),
    sa.Column('evaluator_role', sa.Enum('SELF', 'PEER', 'SUPERVISOR', 'CEO', 'PC_HEAD', name='evaluatorrole'), nullable=False),
    sa.Column('evaluee_id', GUID(), nullable=False),
    sa.Column('weight', sa.Float(), nullable=False),
    sa.Column('teaching_effectiveness', sa.Float(), nullable=True),
    sa.Column('student_engagement', sa.Float(), nullable=True),
    sa.Column('curriculum_implementation', sa.Float(), nullable=True),
    sa.Column('classroom_management', sa.Float(), nullable=True),
    sa.Column('task_management', sa.Float(), nullable=True),
    sa.Column('policy_adherence', sa.Float(), nullable=True),
    sa.Column('interdepartmental_communication', sa.Float(), nullable=True),
    sa.Column('service_quality', sa.Float(), nullable=True),
    sa.Column('collaboration', sa.Float(), nullable=False),
    sa.Column('innovation', sa.Float(), nullable=False),
    sa.Column('attendance', sa.Float(), nullable=False),
    sa.Column('professional_development', sa.Float(), nullable=False),
    sa.Column('average_score', sa.Float(), nullable=False),
    sa.Column('strengths', sa.Text(), nullable=True),
    sa.Column('improvements', sa.Text(), nullable=True),
    sa.Column('comments', sa.Text(), nullable=True),
    sa.Column('submitted_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('metadata', sa.JSON(), nullable=True),
    sa.ForeignKeyConstraint(['cycle_id'], ['evaluation_cycle.id'], ),
    sa.ForeignKeyConstraint(['evaluation_id'], ['evaluation.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_evaluation_rating_cycle_id'), 'evaluation_rating', ['cycle_id'], unique=False)
    op.create_index(op.f('ix_evaluation_rating_evaluation_id'), 'evaluation_rating', ['evaluation_id'], unique=False)
    op.create_index(op.f('ix_evaluation_rating_evaluator_id'), 'evaluation_rating', ['evaluator_id'], unique=False)
    op.create_index(op.f('ix_evaluation_rating_evaluee_id'), 'evaluation_rating', ['evaluee_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_evaluation_rating_evaluee_id'), table_name='evaluation_rating')
    op.drop_index(op.f('ix_evaluation_rating_evaluator_id'), table_name='evaluation_rating')
    op.drop_index(op.f('ix_evaluation_rating_evaluation_id'), table_name='evaluation_rating')
    op.drop_index(op.f('ix_evaluation_rating_cycle_id'), table_name='evaluation_rating')
    op.drop_table('evaluation_rating')
    op.drop_index(op.f('ix_vote_voter_id'), table_name='vote')
    op.drop_index(op.f('ix_vote_nomination_id'), table_name='vote')
    op.drop_table('vote')
    op.drop_index(op.f('ix_evaluation_result_evaluee_id'), table_name='evaluation_result')
    op.drop_index(op.f('ix_evaluation_result_cycle_id'), table_name='evaluation_result')
    op.drop_table('evaluation_result')
    op.drop_index(op.f('ix_evaluation_evaluee_id'), table_name='evaluation')
    op.drop_index(op.f('ix_evaluation_evaluator_id'), table_name='evaluation')
    op.drop_index(op.f('ix_evaluation_cycle_id'), table_name='evaluation')
    op.drop_table('evaluation')
    op.drop_index(op.f('ix_award_recipient_id'), table_name='award')
    op.drop_table('award')
    op.drop_index(op.f('ix_nomination_nominee_id'), table_name='nomination')
    op.drop_table('nomination')
    op.drop_table('fairness_metric')
    op.drop_index(op.f('ix_evaluation_cycle_cycle_period'), table_name='evaluation_cycle')
    op.drop_table('evaluation_cycle')
    op.drop_index(op.f('ix_eoy_candidate_year'), table_name='eoy_candidate')
    op.drop_index(op.f('ix_eoy_candidate_employee_id'), table_name='eoy_candidate')
    op.drop_table('eoy_candidate')
    op.drop_index(op.f('ix_eligibility_tracking_employee_id'), table_name='eligibility_tracking')
    op.drop_table('eligibility_tracking')
    # ### end Alembic commands ###
